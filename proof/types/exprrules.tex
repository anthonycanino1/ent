\begin{figure}[!t]
\scriptsize
%\scriptsize
\hrule
		\begin{mathpar}
			\inferrule*[left=\stitle{Var}]
      {
      }
      { \Gamma; \cset \vdash \VAR : \Gamma(\VAR) }
      \\

			\inferrule*[left=\stitle{New}]
			{
%				\Gamma;\cset \vdash_{\tt wft} \ \classiota \\
\listi = \dynmode, \listi'  \textrm{ iff } \textbf{class}\ \Cname\ \tspec' \dots \in \programcode \textrm{ and } \fundef{ethis}(\tspec') = \dynmode \\
\listi \neq \dynmode, \listi'  \textrm{ iff } \textbf{class}\ \Cname\ \tspec' \dots \in \programcode \textrm{ and } \fundef{ethis}(\tspec') \neq \dynmode \\
\cset \models \fundef{cons}(\tspec')
			}
			{ \Gamma;\cset \vdash\ \new{\classiota} : \classiota			
			}
      \\
			\inferrule*[left=\stitle{Cast}]
			{ \Gamma;\cset \vdash e : \classiota   \\
		%	  \cset \vdash_{\tt wft} \t \\
			}
			{ \Gamma;\cset \vdash (\bt)e: \bt  }
			\\
		  \inferrule*[left=\stitle{Msg}]
			{
			  \Gamma; \cset \vdash\ e: \bt   \\
			  \Fmtype(\Mname, \bt) = \overline{\bt}\rightarrow\bt' \\
				\Gamma; \cset \vdash \overline{e}: \overline{\bt} \\
			  \Gamma; \cset \vdash\ \kwthis: \bt_{this}   \\
        \cset \models \{\Fmode(\bt)\msub\Fmode(\bt_{this})\} \\ \Fmode(\bt) \neq \ ?
		  }
			{\Gamma; \cset \vdash e.\Mname(\overline{e}): \bt' }
			\\
			\inferrule*[left=\stitle{Field}]
			{
        \Gamma;\cset \vdash e : \bt  \\ \Gamma;\cset \vdash \kwthis : \bt_{this} \\
			  \Ffields(\bt) = \overline{\bt}\ \overline{\Fname} \\
        \cset \models \{\Fmode(\bt)\msub\Fmode(\bt_{this})\} \\ \Fmode(\bt) \neq \ ? 
			}
			{\Gamma;\cset \vdash e.\Fname_i :\bt_i   }
			\\
%
%      \inferrule*[left=\stitle{Elim}]
%      {
%        \cset = \overline{\econs} \\ \econs \in \overline{\econs}  \\\\
%        \Gamma;\cset \vdash e : \texist{\econs}.\t  \\
%      }
%      { \Gamma;\cset \vdash e : \t }
%      \\
%      
			\inferrule*[left=\stitle{Snapshot}]
			{ 
        \Gamma;\cset \vdash e : \Cname \lb ?,\listi \rb \\ 
        %\Gamma;\cset \vdash e_{i} : \t_{i}, \textsubscript{i = 1,2}  \\
        \econs = \basemode_1 \msub \mtvar \msub \basemode_2 \\ %\mtvar \ \fresh \\
      }
			{\Gamma;\cset \vdash \snapshot{e}{\basemode_{1}}{\basemode_{2}} : \texist{\econs}. \Cname\lb\mtvar,\listi\rb
      }
      \\
      \inferrule*[left=\stitle{MCase}]
			{
%        \cset \judgewft \classiota \\
				\overline{\moname} = \Fmodes(\programcode) \\
%        \moname_{i} \neq \moname_{j} \ \text{for all} \ i \neq j \\
      \Gamma;  \cset \vdash e_{i} : \bt \text{ for all} \ i \\
			}
			{\Gamma; \cset \vdash \mcase{\bt}{e} : \tmcase{\bt}}
			\\ 

		  \inferrule*[left=\stitle{ElimCase}]
			{
      \Gamma;  \cset \vdash e : \tmcase{\bt} \\
        \basemode \in \fundef{modes}(\programcode) \textrm{ or } \basemode \textrm{ appears in } \cset
			}
			{\Gamma; \cset \vdash \mcasetag{e}{\basemode} : \bt}
      \\

      \inferrule*[left=\stitle{ModeValue}]
      { \moname \in \Fmodes(\programcode) 
      }
      {\Gamma;\tspec \vdash \moname : \modevt
      }
      \\ 

			\inferrule*[left=\stitle{Sub}]
			{
			  \Gamma;\cset \vdash e : \t  \\
			  \cset \vdash \t \tsub \t'
			}
			{\Gamma;\cset \vdash e : \t'}
			\end{mathpar}

\nocaptionrule \caption{Expression Typing}
\label{fig:exprrules}
\end{figure}

