\begin{figure}[!t]
\scriptsize
%\scriptsize
\hrule
		\begin{mathpar}
			\inferrule*[left=\stitle{Var}]
      {
      }
      { \Gamma; \cset \vdash \VAR : \Gamma(\VAR) }
      \\

			\inferrule*[left=\stitle{New}]
			{
        \listi = \dynmode, \listi'\ \textrm{iff}\ \kwclass\ \Cname\ \tspec \dots \in \programcode\ \textrm{and}\ \Fethis(\tspec) = \dynmode \\
        \listi \neq \dynmode, \listi'\ \textrm{iff}\ \kwclass\ \Cname\ \tspec \dots \in \programcode\ \textrm{and}\ \Fethis(\tspec) \neq \dynmode \\
        \cset \models \fundef{cons}(\tspec)
			}
			{ 
        \Gamma;\cset \vdash\ \new{\classiota} : \classiota			
			}
      \\
			\inferrule*[left=\stitle{Cast}]
			{ 
        \Gamma;\cset \vdash e : \bt'   \\
			}
			{ \Gamma;\cset \vdash (\bt)e: \bt  }
			\\
		  \inferrule*[left=\stitle{Msg}]
			{
			  \Gamma; \cset \vdash\ e: \classiota   \\
			  \Fmtype(\Mname, \classiota) = \overline{\bt}\rightarrow\bt \\
				\Gamma; \cset \vdash \overline{e}: \overline{\bt} \\
			  \Gamma; \cset \vdash\ \kwthis: \bt_{this}   \\
        \cset \models \{\Fmode(\classiota)\msub\Fmode(\bt_{this})\} \\ \Fmode(\classiota) \neq \ ?
		  }
			{\Gamma; \cset \vdash e.\Mname(\overline{e}): \bt }
			\\
			\inferrule*[left=\stitle{Field}]
			{
        \Gamma;\cset \vdash e : \classiota  \\ \Gamma;\cset \vdash \kwthis : \bt_{this} \\
			  \Ffields(\classiota) = \overline{\bt}\ \overline{\Fname} \\
        \cset \models \{\Fmode(\classiota)\msub\Fmode(\bt_{this})\} \\ \Fmode(\classiota) \neq \ ? 
			}
			{\Gamma;\cset \vdash e.\Fname_i :\bt_i   }
			\\

			\inferrule*[left=\stitle{Snapshot}]
			{ 
        \Gamma;\cset \vdash e : \Cname \lb ?,\listi \rb \\ 
        %\Gamma;\cset \vdash e_{i} : \t_{i}, \textsubscript{i = 1,2}  \\
        \econs = \basemode_1 \msub \mtvar \msub \basemode_2 \\ %\mtvar \ \fresh \\
      }
			{\Gamma;\cset \vdash \snapshot{e}{\basemode_{1}}{\basemode_{2}} : \texist{\econs}. \Cname\lb\mtvar,\listi\rb
      }
      \\ 
      
      \inferrule*[left=\stitle{MCase}]
			{
%        \cset \judgewft \classiota \\
				\overline{\moname} = \Fmodes(\programcode) \\
%        \moname_{i} \neq \moname_{j} \ \text{for all} \ i \neq j \\
      \Gamma;  \cset \vdash e_{i} : \bt \text{ for all} \ i \\
			}
			{\Gamma; \cset \vdash \mcase{\bt}{e} : \tmcase{\bt}}
			\\ 

		  \inferrule*[left=\stitle{ElimCase}]
			{
      \Gamma;  \cset \vdash e : \tmcase{\bt} \\
        \basemode \in \fundef{modes}(\programcode) \textrm{ or } \basemode \textrm{ appears in } \cset
			}
			{\Gamma; \cset \vdash \mcasetag{e}{\basemode} : \bt}
      \\

      \inferrule*[left=\stitle{ModeValue}]
      { \moname \in \Fmodes(\programcode) 
      }
      {\Gamma;\cset \vdash \moname : \modevt
      }
      \\ 

			\inferrule*[left=\stitle{Sub}]
			{
			  \Gamma;\cset \vdash e : \t  \\
			  \cset \vdash \t \tsub \t'
			}
			{\Gamma;\cset \vdash e : \t'}
			\end{mathpar}

\nocaptionrule \caption{Expression Typing}
\label{fig:exprrules}
\end{figure}

